<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bowflex Revolution Guide v10.0 (Data Enabled)</title>
    <style>
        /* --- ACCESSIBILITY & HIGH CONTRAST CORE --- */
        :root {
            --bg-color: #000000;
            --text-color: #FFFFFF;
            --accent-color: #FFFF00; /* Yellow for high visibility */
            --btn-bg: #333333;
            --btn-border: #FFFFFF;
            --btn-focus: #0055FF;
            --input-bg: #222222;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Verdana', 'Arial', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #1a1a1a;
            padding: 1rem;
            text-align: center;
            border-bottom: 2px solid var(--accent-color);
        }

        h1 {
            color: var(--accent-color);
            margin: 0;
            font-size: 1.8rem;
        }

        main {
            padding: 1rem;
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 3rem;
        }

        /* --- NAVIGATION BUTTONS --- */
        .nav-item {
            display: block;
            width: 100%;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background-color: var(--btn-bg);
            color: var(--text-color);
            border: 2px solid var(--btn-border);
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .nav-item:hover, .nav-item:focus {
            background-color: #444;
            outline: 4px solid var(--accent-color);
            transform: scale(1.02);
        }

        .back-btn {
            background-color: #000;
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
        }

        .back-btn:hover, .back-btn:focus {
            background-color: var(--accent-color);
            color: #000;
        }

        /* --- CONTENT BOXES --- */
        .info-box {
            background-color: #111;
            border: 1px solid #555;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .box-warning {
            border: 2px solid #FF4444;
            background-color: #220000;
        }

        .box-success {
            border: 2px solid #00FF00;
            background-color: #002200;
        }

        h2 {
            border-bottom: 1px solid #555;
            padding-bottom: 0.5rem;
            color: var(--accent-color);
        }

        h3 {
            color: #AAA;
            margin-top: 1.5rem;
        }

        ul.bulleted {
            list-style-type: square;
            padding-left: 1.5rem;
        }

        li {
            margin-bottom: 0.8rem;
        }

        a {
            color: var(--accent-color);
            text-decoration: underline;
            font-weight: bold;
            display: inline-block;
            padding: 5px 0;
        }

        /* --- FORMS & INPUTS --- */
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        select, input, textarea {
            width: 100%;
            padding: 1rem;
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            background-color: var(--input-bg);
            color: white;
            border: 2px solid white;
            border-radius: 4px;
            box-sizing: border-box; /* Ensures padding doesn't affect width */
        }
        
        select:disabled {
            opacity: 0.5;
            border-color: #555;
        }

        textarea {
            min-height: 100px;
            font-family: inherit;
        }

        /* --- UTILITIES --- */
        .hidden { display: none; }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--accent-color);
            color: black;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

    </style>
</head>
<body>

<header role="banner">
    <h1>Bowflex Revolution v10</h1>
    <p style="font-size: 1rem;">Training Log & Guide</p>
</header>

<main id="app-root" role="main" aria-live="polite">
    <!-- Content injected via JS -->
</main>

<!-- Notification Toast for Screen Readers -->
<div id="toast" class="toast" role="alert">Settings Saved</div>

<script>
    /* --- 1. DATA MANAGEMENT SYSTEM --- */
    
    // Load data from LocalStorage or create empty object
    let userHistory = JSON.parse(localStorage.getItem('bowflex_data_v1')) || {};

    function saveHistory() {
        localStorage.setItem('bowflex_data_v1', JSON.stringify(userHistory));
        showToast("Data Saved");
    }

    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(userHistory));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        const date = new Date().toISOString().slice(0, 10);
        downloadAnchorNode.setAttribute("download", `bowflex_backup_${date}.json`);
        document.body.appendChild(downloadAnchorNode); // required for firefox
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importData(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const contents = e.target.result;
                const parsed = JSON.parse(contents);
                userHistory = parsed;
                saveHistory();
                alert("Backup restored successfully! Your past weights are loaded.");
                renderSettings(); // Refresh view
            } catch (err) {
                alert("Error reading file. Please ensure it is a valid JSON backup.");
            }
        };
        reader.readAsText(file);
    }

    function clearData() {
        if(confirm("Are you sure? This will delete all recorded weights and notes.")) {
            userHistory = {};
            saveHistory();
            renderSettings();
        }
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.opacity = '1';
        setTimeout(() => { t.style.opacity = '0'; }, 2000);
    }

    /* --- 2. CONTENT DATABASE --- */
    const SECTIONS = {
        safety: `
            <h3>Safety Precautions</h3>
            <div class="info-box box-warning">
                <h4>CRITICAL WARNINGS</h4>
                <ul class="bulleted">
                    <li><strong>Clearance:</strong> Keep 7 feet of free space.</li>
                    <li><strong>Locking:</strong> ALWAYS ensure Freedom Arms are locked.</li>
                    <li><strong>Stop:</strong> If you feel faint or pain, stop immediately.</li>
                </ul>
            </div>
        `,
        gettingStarted: `
            <h3>Getting to Know Your Machine</h3>
            <h4>The Freedom Arms (Positions 1-9)</h4>
            <ul class="bulleted">
                <li><strong>Pos 1 (High):</strong> Pulldowns, Triceps.</li>
                <li><strong>Pos 2-4 (Upper):</strong> Incline Press.</li>
                <li><strong>Pos 5 (Middle):</strong> Chest Press, Rows.</li>
                <li><strong>Pos 6-8 (Lower):</strong> Decline Press.</li>
                <li><strong>Pos 9 (Low):</strong> Squats, Curls.</li>
            </ul>
        `,
        maintenance: `
            <h3>Maintenance</h3>
            <ul class="bulleted">
                <li><strong>Daily:</strong> Check cables for wear.</li>
                <li><strong>Weekly:</strong> Clean bench.</li>
            </ul>
        `,
        resources: `
            <h3>PDF & Video Resources</h3>
            <div class="info-box">
                <h4>Official PDF Manuals</h4>
                <ul class="bulleted">
                    <li><a href="https://download.bowflex.com/supportdocs/OM/Bowflex/BFX_Revolution_OM_RevC_web.pdf" target="_blank">Owner's Manual (PDF)</a></li>
                    <li><a href="https://download.bowflex.com/supportdocs/AM/Bowflex/BFX_Revolution_AM_RevA_web.pdf" target="_blank">Assembly Manual (PDF)</a></li>
                </ul>
            </div>
            <div class="info-box">
                <h4>Community Links</h4>
                <ul class="bulleted">
                    <li><a href="https://www.youtube.com/c/bowflexworkouts/videos" target="_blank">Bowflex Workouts YouTube</a></li>
                    <li><a href="https://www.reddit.com/r/Bowflex/" target="_blank">r/Bowflex Reddit</a></li>
                </ul>
            </div>
        `
    };

    /* --- 3. EXERCISE DATABASE (128+ Entries) --- */
    const EXERCISES = {
        chest: [
            { name: "Bench Press (Flat - Bar)", setup: "Arms: Pos 5 (Horizontal). Bench: Flat.", tip: "Standard chest press." },
            { name: "Bench Press (Flat - Handles)", setup: "Arms: Pos 5 (Horizontal). Bench: Flat.", tip: "Allows deeper stretch." },
            { name: "Bench Press (Incline - Bar)", setup: "Arms: Pos 4 (Angled Up). Bench: 45¬∞.", tip: "Target upper chest." },
            { name: "Bench Press (Incline - Handles)", setup: "Arms: Pos 4 (Angled Up). Bench: 45¬∞.", tip: "Upper chest handles." },
            { name: "Bench Press (Decline)", setup: "Arms: Pos 6 (Angled Down). Bench: Flat.", tip: "Press slightly downward." },
            { name: "Chest Fly (Flat)", setup: "Arms: Pos 5. Bench: Flat.", tip: "Wide arc motion." },
            { name: "Chest Fly (Incline)", setup: "Arms: Pos 4. Bench: 45¬∞.", tip: "Upper chest fly." },
            { name: "Close Grip Press", setup: "Arms: Pos 5. Bench: Flat.", tip: "Hands together." },
            { name: "Cable Crossover", setup: "Arms: Pos 1 (High). Standing.", tip: "Pull down across body." },
            { name: "Resisted Punch", setup: "Arms: Pos 5. Standing.", tip: "Alternating punches." },
            { name: "One Arm Bench Press", setup: "Arms: Pos 5. Bench: Flat.", tip: "Core stability." }
        ],
        shoulders: [
            { name: "Seated Shoulder Press", setup: "Arms: Pos 9 (Low). Bench: Vertical.", tip: "Press straight up." },
            { name: "Standing Shoulder Press", setup: "Arms: Pos 9 (Low). Standing.", tip: "Press overhead." },
            { name: "Front Shoulder Raise", setup: "Arms: Pos 9. Standing.", tip: "Raise straight forward." },
            { name: "Lateral Raise", setup: "Arms: Pos 9. Standing.", tip: "Raise to side." },
            { name: "Rear Delt Row", setup: "Arms: Pos 5 (Mid). Standing.", tip: "Pull elbows back high." },
            { name: "Crossover Rear Delt", setup: "Arms: Pos 5. Standing.", tip: "Cross cables. Pull back." },
            { name: "Reverse Fly", setup: "Arms: Pos 5. Standing.", tip: "Straight arm reverse." },
            { name: "Shrugs", setup: "Arms: Pos 9. Standing.", tip: "Shrug shoulders to ears." },
            { name: "Rotator Cuff (Int)", setup: "Arms: Pos 5. Side Stand.", tip: "Rotate across belly." },
            { name: "Rotator Cuff (Ext)", setup: "Arms: Pos 5. Side Stand.", tip: "Rotate outward." }
        ],
        back: [
            { name: "Seated Lat Row (Bar)", setup: "Arms: Pos 9 (Low). Bench: Flat.", tip: "Row with bar." },
            { name: "Seated Lat Row (Handles)", setup: "Arms: Pos 9. Bench: Flat.", tip: "Row with handles." },
            { name: "Standing Low Back Ext", setup: "Arms: Pos 9. Harness.", tip: "Hinge at hips." },
            { name: "Bent Over Row", setup: "Arms: Pos 9. Standing.", tip: "Flat back, pull to waist." },
            { name: "Lat Pulldown (Wide)", setup: "Arms: Pos 1 (High). Bench: Locked.", tip: "Wide grip." },
            { name: "Lat Pulldown (Narrow)", setup: "Arms: Pos 1. Bench: Locked.", tip: "Close grip." },
            { name: "Reverse Grip Pulldown", setup: "Arms: Pos 1. Bench: Locked.", tip: "Palms facing you." },
            { name: "Stiff Arm Pulldown", setup: "Arms: Pos 1. Standing.", tip: "Straight arms down to thighs." },
            { name: "Pullover (Lying)", setup: "Arms: Pos 9. Bench: Flat.", tip: "Pull from behind head." },
            { name: "One Arm Row", setup: "Arms: Pos 9. Seated.", tip: "Isolate one side." }
        ],
        arms: [
            { name: "Triceps Pushdown", setup: "Arms: Pos 1 (High). Standing.", tip: "Elbows pinned." },
            { name: "Triceps Extension (Overhead)", setup: "Arms: Pos 5 (Mid). Seated.", tip: "French press." },
            { name: "Triceps Kickback", setup: "Arms: Pos 9 (Low). Bent Over.", tip: "Extend arm back." },
            { name: "Lying Triceps Ext", setup: "Arms: Pos 9. Bench: Flat.", tip: "Skullcrushers." },
            { name: "Biceps Curl (Standing)", setup: "Arms: Pos 9 (Low). Standing.", tip: "Standard curl." },
            { name: "Seated Curl", setup: "Arms: Pos 9. Seated.", tip: "Strict form." },
            { name: "Concentration Curl", setup: "Arms: Pos 9. Seated.", tip: "Elbow on knee." },
            { name: "Hammer Curl", setup: "Arms: Pos 9. Standing.", tip: "Neutral grip." },
            { name: "Preacher Curl", setup: "Arms: Pos 9. Preacher Attach.", tip: "Elbows supported." },
            { name: "Wrist Curl", setup: "Arms: Pos 9. Seated.", tip: "Forearms." }
        ],
        legs: [
            { name: "Leg Extension", setup: "Arms: Pos 9. Leg Attach.", tip: "Quads." },
            { name: "Leg Curl (Lying)", setup: "Arms: Pos 9. Leg Attach.", tip: "Hamstrings." },
            { name: "Leg Press", setup: "Arms: Pos 9. Seatback.", tip: "Push with heels." },
            { name: "Squat (Bar)", setup: "Arms: Pos 9. Standing.", tip: "Bar on shoulders." },
            { name: "Squat (Harness)", setup: "Arms: Pos 9. Standing.", tip: "Harness on shoulders." },
            { name: "Calf Raise", setup: "Arms: Pos 9. Leg Press Setup.", tip: "Toe press." },
            { name: "Glute Kickback", setup: "Arms: Pos 9. Ankle Cuff.", tip: "Kick straight back." },
            { name: "Deadlift", setup: "Arms: Pos 9. Bar.", tip: "Hinge at hips." },
            { name: "Lunge", setup: "Arms: Pos 9. Harness.", tip: "Step forward." }
        ],
        core: [
            { name: "Resisted Crunch", setup: "Arms: Pos 1 (High). Harness.", tip: "Crunch forward." },
            { name: "Oblique Crunch", setup: "Arms: Pos 1. Harness.", tip: "Crunch diagonally." },
            { name: "Woodchop (High-Low)", setup: "Arms: Pos 1. Standing.", tip: "Chop down." },
            { name: "Woodchop (Low-High)", setup: "Arms: Pos 9. Standing.", tip: "Chop up." },
            { name: "Trunk Rotation", setup: "Arms: Pos 5. Seated.", tip: "Twist torso." },
            { name: "Reverse Crunch", setup: "Arms: Pos 9. Leg Attach.", tip: "Knees to chest." },
            { name: "Side Bend", setup: "Arms: Pos 9. Standing.", tip: "Bend sideways." }
        ]
    };

    /* --- 4. APP VIEW LOGIC --- */
    const appRoot = document.getElementById('app-root');

    function renderMenu() {
        // Generate Step 1 Dropdown
        let groupOptions = '<option value="" disabled selected>Select Muscle Group...</option>';
        for(const group of Object.keys(EXERCISES)) {
            const niceName = group.toUpperCase();
            groupOptions += `<option value="${group}">${niceName}</option>`;
        }

        appRoot.innerHTML = `
            <div class="view active">
                
                <div class="info-box" style="border-color: var(--accent-color);">
                    <h3>‚ö° Quick Access</h3>
                    
                    <label for="groupFilter">Step 1: Choose Body Part</label>
                    <select id="groupFilter" onchange="updateExerciseDropdown(this.value)">${groupOptions}</select>
                    
                    <label for="exerciseSelect">Step 2: Choose Exercise</label>
                    <select id="exerciseSelect" disabled onchange="handleShortcut(this.value)">
                        <option>Select a body part first...</option>
                    </select>
                </div>

                <nav>
                    <button class="nav-item" onclick="renderSection('safety')">1. Safety Instructions</button>
                    <button class="nav-item" onclick="renderSection('gettingStarted')">2. Getting Started</button>
                    <button class="nav-item" onclick="renderExerciseMenu()">3. Full Exercise List</button>
                    <button class="nav-item" onclick="renderSettings()">4. Settings & Data Backup</button>
                    <button class="nav-item" onclick="renderSection('resources')">5. PDF Resources</button>
                </nav>
            </div>
        `;
    }

    function updateExerciseDropdown(group) {
        const select = document.getElementById('exerciseSelect');
        const list = EXERCISES[group];
        let html = '<option value="" disabled selected>Select an Exercise...</option>';
        list.forEach((ex, idx) => {
            html += `<option value="${group}|${idx}">${ex.name}</option>`;
        });
        select.innerHTML = html;
        select.disabled = false;
        select.focus();
    }

    function handleShortcut(val) {
        if(!val) return;
        const [group, idx] = val.split('|');
        renderExerciseDetail(group, parseInt(idx));
    }

    function renderExerciseMenu() {
        let html = `
            <div class="view active">
                <button class="back-btn" onclick="renderMenu()">‚Üê Back to Main Menu</button>
                <h2>Select Muscle Group</h2>
                <nav>
        `;
        for(const group of Object.keys(EXERCISES)) {
            html += `<button class="nav-item" onclick="renderExerciseList('${group}')">${group.toUpperCase()}</button>`;
        }
        html += `</nav></div>`;
        appRoot.innerHTML = html;
    }

    function renderExerciseList(group) {
        const list = EXERCISES[group];
        let html = `
            <div class="view active">
                <button class="back-btn" onclick="renderExerciseMenu()">‚Üê Back to Categories</button>
                <h2>${group.toUpperCase()} (${list.length})</h2>
                <nav>
        `;
        list.forEach((ex, index) => {
            html += `<button class="nav-item" onclick="renderExerciseDetail('${group}', ${index})">${ex.name}</button>`;
        });
        html += `</nav></div>`;
        appRoot.innerHTML = html;
    }

    function renderExerciseDetail(group, index) {
        const ex = EXERCISES[group][index];
        const id = `${group}|${index}`;
        
        // Retrieve saved data for this specific exercise
        const savedData = userHistory[id] || { weight: '', notes: '' };

        appRoot.innerHTML = `
            <div class="view active">
                <button class="back-btn" onclick="renderExerciseList('${group}')">‚Üê Back to List</button>
                
                <div class="info-box" role="article">
                    <h2 style="font-size: 2rem; color: var(--accent-color);">${ex.name}</h2>
                    
                    <h3>‚öôÔ∏è Setup</h3>
                    <p style="font-size: 1.4rem;">${ex.setup}</p>
                    
                    <h3>üí° Pro Tip</h3>
                    <p style="font-size: 1.4rem;">${ex.tip}</p>
                </div>

                <div class="info-box box-success">
                    <h3>üìù Log Progress</h3>
                    
                    <label for="weightIn">Weight Used (lbs):</label>
                    <input type="number" id="weightIn" value="${savedData.weight}" placeholder="e.g. 80" onchange="updateHistory('${id}', 'weight', this.value)">
                    
                    <label for="notesIn">Notes:</label>
                    <textarea id="notesIn" placeholder="e.g. Seat pos 4, hard last rep" onchange="updateHistory('${id}', 'notes', this.value)">${savedData.notes}</textarea>
                    
                    <p id="saveMsg_${id}" style="color:var(--accent-color); font-weight:bold; display:none;" aria-live="polite">Saved!</p>
                </div>
            </div>
        `;
    }

    function updateHistory(id, field, value) {
        if (!userHistory[id]) userHistory[id] = {};
        userHistory[id][field] = value;
        
        saveHistory(); // Write to localstorage
        
        // Show visual feedback
        const msg = document.getElementById(`saveMsg_${id}`);
        if(msg) {
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 2000);
        }
    }

    function renderSection(sectionId) {
        const content = SECTIONS[sectionId] || "<p>Content loading...</p>";
        appRoot.innerHTML = `
            <div class="view active">
                <button class="back-btn" onclick="renderMenu()">‚Üê Back to Main Menu</button>
                <div tabindex="0" role="document" style="outline:none;">
                    ${content}
                </div>
            </div>
        `;
    }

    function renderSettings() {
        appRoot.innerHTML = `
            <div class="view active">
                <button class="back-btn" onclick="renderMenu()">‚Üê Back to Main Menu</button>
                <h2>Settings & Data</h2>
                
                <div class="info-box">
                    <h3>Backup Data</h3>
                    <p>Save your progress to the iOS Files app (iCloud/On My iPhone).</p>
                    <button class="nav-item" onclick="exportData()">‚¨áÔ∏è Export Backup File</button>
                </div>

                <div class="info-box">
                    <h3>Restore Data</h3>
                    <p>Load a previously saved backup file.</p>
                    <input type="file" id="importFile" accept=".json" style="margin-bottom:1rem;" onchange="importData(event)">
                </div>

                <div class="info-box box-warning">
                    <h3>Danger Zone</h3>
                    <button class="nav-item" style="background-color:#400; border-color:red;" onclick="clearData()">üóëÔ∏è Clear All Data</button>
                </div>
            </div>
        `;
    }

    // Initialize
    renderMenu();
</script>

</body>
</html>
